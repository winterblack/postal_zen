!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof module&&module.exports?module.exports=function(t,i){return void 0===i&&(i="undefined"!=typeof window?require("jquery"):require("jquery")(t)),e(i)}:e(window.jQuery)}(function(e){e.extend(e.FE.DEFAULTS,{wordDeniedTags:[],wordDeniedAttrs:[],wordAllowedStyleProps:["font-family","font-size","background","color","width","text-align","vertical-align","background-color"]}),e.FE.PLUGINS.wordPaste=function(t){function i(){t.events.on("paste.beforeCleanup",function(e){return t.paste.isWord(e)&&(e=e.replace(/^\n*/g,"").replace(/^ /g,""),0===e.indexOf("<colgroup>")&&(e="<table>"+e+"</table>"),e=T(e,t.paste.getRtfClipboard()),e=t.paste.removeEmptyTags(e)),e})}function r(e){e.parentNode&&e.parentNode.removeChild(e)}function n(e,t){if(t(e))for(var i=e.firstChild;i;){var r=i,l=i.previousSibling;i=i.nextSibling,n(r,t),r.previousSibling||r.nextSibling||r.parentNode||!i||l==i.previousSibling||!i.parentNode?r.previousSibling||r.nextSibling||r.parentNode||!i||i.previousSibling||i.nextSibling||i.parentNode||(l?i=l.nextSibling?l.nextSibling.nextSibling:null:e.firstChild&&(i=e.firstChild.nextSibling)):i=l?l.nextSibling:e.firstChild}}function l(e){return e.nodeType==Node.ELEMENT_NODE&&e.getAttribute("style")&&e.getAttribute("style").replace(/\n/gi,"").indexOf("mso-list:Ignore")!=-1}function a(e){if(!e.getAttribute("style")||!/mso-list:[\s]*l/gi.test(e.getAttribute("style").replace(/\n/gi,"")))return!1;try{var t=e.firstElementChild.firstElementChild,i=t.firstElementChild?t.firstElementChild:null;if(!l(t)&&!l(i))return!1}catch(e){return!1}return!0}function s(e){return e.getAttribute("style").replace(/\n/gi,"").replace(/.*level([0-9]+?).*/gi,"$1")}function o(e,t){var i=e.cloneNode(!0);if(i.firstElementChild&&"A"==i.firstElementChild.tagName&&(i=i.firstElementChild),r(i.firstElementChild),["H1","H2","H3","H4","H5","H6"].indexOf(e.tagName)!=-1){var l=document.createElement(e.tagName.toLowerCase());l.setAttribute("style",e.getAttribute("style")),l.innerHTML=i.innerHTML,i.innerHTML=l.outerHTML}n(i,function(e){return e.nodeType==Node.ELEMENT_NODE&&A(e,null,t),!0});var a=i.innerHTML;return a=a.replace(/<!--[\s\S]*?-->/gi,"")}function f(e,t){var i=/[0-9a-zA-Z]./gi,n=!1;e.firstElementChild&&e.firstElementChild.firstElementChild&&e.firstElementChild.firstElementChild.firstChild&&!(n=n||i.test(e.firstElementChild.firstElementChild.firstChild.data))&&e.firstElementChild.firstElementChild.firstElementChild&&e.firstElementChild.firstElementChild.firstElementChild.firstChild&&(n=n||i.test(e.firstElementChild.firstElementChild.firstElementChild.firstChild.data));var l=n?"ol":"ul",u=s(e),d="<"+l+"><li>"+o(e,t),g=e.nextElementSibling,m=e.parentNode;for(r(e),e=null;g&&a(g);){var h=g.previousElementSibling,p=s(g);if(p>u)d+=f(g,t).outerHTML;else{if(p<u)break;d+="</li><li>"+o(g,t)}if(u=p,g.previousElementSibling||g.nextElementSibling||g.parentNode){var c=g;g=g.nextElementSibling,r(c),c=null}else g=h?h.nextElementSibling:m.firstElementChild}d+="</li></"+l+">";var b=document.createElement("div");return b.innerHTML=d,b.firstElementChild}function u(e,t){for(var i=document.createElement(t),r=0;r<e.attributes.length;r++){var n=e.attributes[r].name;i.setAttribute(n,e.getAttribute(n))}return i.innerHTML=e.innerHTML,e.parentNode.replaceChild(i,e),i}function d(e){var t=null;if(e.firstElementChild&&(t=e.firstElementChild.tagName,["SPAN","STRONG","B","S","EM","U","SUB","SUP"].indexOf(t)!=-1)){if("TD"!=e.tagName)for(var i=e.firstElementChild;i;){if("SPAN"==i.tagName){p(i,e.getAttribute("style"));break}i=i.firstElementChild}}else if("DIV"!=t){var r=e.getAttribute("style"),n=document.createElement("span");r&&(r=h(r),n.setAttribute("style",r)),n.innerHTML=e.innerHTML,e.innerHTML=n.outerHTML}}function g(i,n){t.node.clearAttributes(i);for(var l=i.firstElementChild,s=0,o=!1,f=null;l;){l.firstElementChild&&l.firstElementChild.tagName.indexOf("W:")!=-1&&(l.innerHTML=l.firstElementChild.innerHTML),f=l.getAttribute("width"),f||o||(o=!0),s+=parseInt(f,10),(!l.firstChild||l.firstChild&&l.firstChild.data==e.FE.UNICODE_NBSP)&&(l.firstChild&&r(l.firstChild),l.innerHTML="<br>");for(var g=l.firstElementChild,c=1==l.children.length;g;){if("P"==g.tagName&&!a(g)){var v=null;1==g.children.length&&g.firstElementChild&&"SPAN"==g.firstElementChild.tagName?(v=g.firstElementChild,c||(v=u(v,"div")),c?p(l,g.getAttribute("style")):p(v,g.getAttribute("style")),l.replaceChild(v,g)):(v=u(g,c?"span":"div"),!c&&v.getAttribute("align")&&v.removeAttribute("align")),g=v,c&&m(g)}g=g.nextElementSibling}if(n){var E=l.getAttribute("class");if(E){E=h(E);var A=E.match(/xl[0-9]+/gi);if(A){var C=A[0],T="."+C;n[T]&&p(l,n[T])}}n.td&&p(l,n.td),d(l),b(l)}var N=l.getAttribute("style");N&&(N=h(N))&&";"!=N.slice(-1)&&(N+=";");var S=l.getAttribute("valign");if(!S&&N){var y=N.match(/vertical-align:.+?[; "]{1,1}/gi);y&&(S=y[y.length-1].replace(/vertical-align:(.+?)[; "]{1,1}/gi,"$1"))}var L=null;if(N){var M=N.match(/text-align:.+?[; "]{1,1}/gi);M&&(L=M[M.length-1].replace(/text-align:(.+?)[; "]{1,1}/gi,"$1")),"general"==L&&(L=null)}var x=null;if(N){var H=N.match(/background:.+?[; "]{1,1}/gi);H&&(x=H[H.length-1].replace(/background:(.+?)[; "]{1,1}/gi,"$1"))}var O=l.getAttribute("colspan");t.node.clearAttributes(l),O&&l.setAttribute("colspan",O),S&&(l.style["vertical-align"]=S),L&&(l.style["text-align"]=L),x&&(l.style["background-color"]=x),f&&l.setAttribute("width",f),l=l.nextElementSibling}for(l=i.firstElementChild;l;)f=l.getAttribute("width"),o?l.removeAttribute("width"):l.setAttribute("width",100*parseInt(f,10)/s+"%"),l=l.nextElementSibling}function m(e){var t=e.parentNode,i=e.getAttribute("align");i&&(t&&"TD"==t.tagName?(t.setAttribute("style",t.getAttribute("style")+"text-align:"+i+";"),e.removeAttribute("align")):(e.style["text-align"]=i,e.removeAttribute("align")))}function h(e){return e.replace(/\n|\r|\n\r|&quot;/g,"")}function p(e,t,i){if(t){var r=e.getAttribute("style");r&&";"!=r.slice(-1)&&(r+=";"),t&&";"!=t.slice(-1)&&(t+=";"),t=t.replace(/\n/gi,"");var n=null;n=i?(r||"")+t:t+(r||""),e.setAttribute("style",n)}}function c(e){var t=e.getAttribute("style");if(t){(t=h(t))&&";"!=t.slice(-1)&&(t+=";");var i=t.match(/(^|\S+?):.+?;{1,1}/gi);if(i){for(var r={},n=0;n<i.length;n++){var l=i[n],a=l.split(":");2==a.length&&("text-align"==a[0]&&"SPAN"==e.tagName||(r[a[0]]=a[1]))}var s="";for(var o in r)if(r.hasOwnProperty(o)){if("font-size"==o&&"pt;"==r[o].slice(-3)){var f=null;try{f=parseFloat(r[o].slice(0,-3),10)}catch(e){}f&&(f=Math.round(1.33*f),r[o]=f+"px;")}s+=o+":"+r[o]}s&&e.setAttribute("style",s)}}}function b(e){var t=e.getAttribute("style");if(t){t=h(t);var i=t.match(/(^|;)font-weight:.+?[; "]{1,1}/gi),r=null;if(i&&(r=i[i.length-1].replace(/(^|;)font-weight:(.+?)[; "]{1,1}/gi,"$2")),r&&(r>=700||"bold"==r)){var n=document.createElement("strong");n.innerHTML=e.innerHTML,e.innerHTML=n.outerHTML}}}function v(e){for(var t=e.match(/[0-9a-f]{2}/gi),i=[],r=0;r<t.length;r++)i.push(String.fromCharCode(parseInt(t[r],16)));var n=i.join("");return btoa(n)}function E(e,t){if(t){var i=e.getAttribute("src");if(i&&i.indexOf("file://")!=-1){var r=e.getAttribute("v:shapes");if(r){if(r.indexOf("Picture")!=-1&&e.previousSibling){var n=e.previousSibling.previousSibling;if(!n)return;var l=n.data.split('o:spid="');if(2!=l.length)return;if(l=l[1].split('"'),l.length<2)return;r=l[0]}var a="hplid"+r.substring(8),s=t.split(a);if(!s||2==s.length){var o=s[1].split("bliptag");if(!(o&&o.length<2)){var f=null;if(o[0].indexOf("pngblip")!=-1?f="image/png":o[0].indexOf("jpegblip")!=-1&&(f="image/jpeg"),f){var u=o[1].split("}");if(!(u&&u.length<2)){var d;if(u.length>2&&u[0].indexOf("blipuid")!=-1)d=u[1].split(" ");else{if((d=u[0].split(" "))&&d.length<2)return;d.shift()}var g=d.join(""),m=v(g),h="data:"+f+";base64,"+m;e.setAttribute("src",h)}}}}}}}}function A(i,n){var l=i.tagName,a=l.toLowerCase();if(i.firstElementChild&&("I"==i.firstElementChild.tagName?u(i.firstElementChild,"em"):"B"==i.firstElementChild.tagName&&u(i.firstElementChild,"strong")),["SCRIPT","APPLET","EMBED","NOFRAMES","NOSCRIPT"].indexOf(l)!=-1)return r(i),!1;"O:P"==l&&"&nbsp;"==i.innerHTML&&(i.innerHTML=e.FE.INVISIBLE_SPACE);var s=-1,o=["META","LINK","XML","ST1:","O:","W:","FONT"];for(s=0;s<o.length;s++)if(l.indexOf(o[s])!=-1)return i.innerHTML?(i.outerHTML=i.innerHTML,r(i),!1):(r(i),!1);if("TD"!=l){var f=i.getAttribute("class");if(n&&f){f=h(f);var c=f.split(" ");for(s=0;s<c.length;s++){var v=c[s],E=[],A="."+v;E.push(A),A=a+A,E.push(A);for(var C=0;C<E.length;C++)n[E[C]]&&p(i,n[E[C]])}}n&&n[a]&&p(i,n[a])}if(["P","H1","H2","H3","H4","H5","H6","PRE"].indexOf(l)!=-1){d(i),b(i);var T=i.getAttribute("style"),N=null;if(T){var S=T.match(/text-align:.+?[; "]{1,1}/gi);S&&(N=S[S.length-1].replace(/(text-align:.+?[; "]{1,1})/gi,"$1"))}N?i.setAttribute("style",N):i.removeAttribute("style")}if("P"==l&&m(i),"TR"==l&&g(i,n),i.getAttribute("class")&&i.getAttribute("class").toLowerCase().indexOf("mso")!=-1){var y=h(i.getAttribute("class"));y=y.replace(/[0-9a-z-_]*mso[0-9a-z-_]*/gi,""),y?i.setAttribute("class",y):i.removeAttribute("class")}if("A"==l&&!i.attributes.getNamedItem("href")&&i.innerHTML&&(i.outerHTML=i.innerHTML),"TD"!=l&&"TH"!=l||i.innerHTML||(i.innerHTML="<br>"),"TABLE"==l&&(t.node.clearAttributes(i),i.setAttribute("style","width: 100%;")),i.getAttribute("lang")&&i.removeAttribute("lang"),i.getAttribute("style")&&i.getAttribute("style").toLowerCase().indexOf("mso")!=-1){var L=h(i.getAttribute("style"));L=L.replace(/[0-9a-z-_]*mso[0-9a-z-_]*:.+?(;{1,1}|$)/gi,""),L?i.setAttribute("style",L):i.removeAttribute("style")}return!0}function C(e){var t={},i=e.getElementsByTagName("style");if(i.length){var r=i[0],n=r.innerHTML.match(/[\S ]+\s+{[\s\S]+?}/gi);if(n)for(var l=0;l<n.length;l++){var a=n[l],s=a.replace(/([\S ]+\s+){[\s\S]+?}/gi,"$1"),o=a.replace(/[\S ]+\s+{([\s\S]+?)}/gi,"$1");s=s.replace(/^[\s]|[\s]$/gm,""),o=o.replace(/^[\s]|[\s]$/gm,""),s=s.replace(/\n|\r|\n\r/g,""),o=o.replace(/\n|\r|\n\r/g,"");for(var f=s.split(", "),u=0;u<f.length;u++)t[f[u]]=o}}return t}function T(i,l){i=i.replace(/[.\s\S\w\W<>]*(<html[^>]*>[.\s\S\w\W<>]*<\/html>)[.\s\S\w\W<>]*/gi,"$1");var s=new DOMParser,o=s.parseFromString(i,"text/html"),u=o.head,d=o.body,g=C(u);n(d,function(t){if(t.nodeType==Node.TEXT_NODE&&/\n/.test(t.data)){if(!/\S/.test(t.data))return t.data==e.FE.UNICODE_NBSP||(r(t),!1);t.data=t.data.replace(/\n/gi," ")}return!0}),n(d,function(e){return e.nodeType==Node.ELEMENT_NODE&&"IMG"==e.tagName&&E(e,l),!0}),n(d,function(e){if(e.nodeType==Node.TEXT_NODE)return e.data=e.data.replace(/<br>(\n|\r)/gi,"<br>"),!1;if(e.nodeType==Node.ELEMENT_NODE){if(a(e)){var t=e.parentNode,i=e.previousSibling,n=f(e,l),s=null;return s=i?i.nextSibling:t.firstChild,s?t.insertBefore(n,s):t.appendChild(n),!1}return A(e,g,l)}return e.nodeType!=Node.COMMENT_NODE||(r(e),!1)}),n(d,function(e){if(e.nodeType==Node.ELEMENT_NODE){var t=e.tagName;if(!e.innerHTML&&["BR","IMG"].indexOf(t)==-1){for(var i=e.parentNode;i&&(r(e),e=i,!e.innerHTML);)i=e.parentNode;return!1}c(e)}return!0});var m=d.outerHTML,h=t.opts.htmlAllowedStyleProps;return t.opts.htmlAllowedStyleProps=t.opts.wordAllowedStyleProps,m=t.clean.html(m,t.opts.wordDeniedTags,t.opts.wordDeniedAttrs,!1),t.opts.htmlAllowedStyleProps=h,m}return{_init:i}}});